---
title: "ãƒãƒ«ã‚³ãƒ•é€£é–ã‚’ä½¿ã£ã¦è‡ªåˆ†ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‹ã‚‰æ–°ãŸãªæ–‡ç« ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆ2023å¹´3æœˆç‰ˆï¼‰"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Python, ãƒãƒ«ã‚³ãƒ•é€£é–, Twitter]
published: true
published_at: 2023-04-02
---

## ã¯ã˜ã‚ã«

ä»Šå¹´ã®ã‚¨ã‚¤ãƒ—ãƒªãƒ«ãƒ•ãƒ¼ãƒ«ã®ãƒã‚¿ã¨ã—ã¦ã€ã€Œè‡ªåˆ†ã¯å®Ÿã¯AIã§ã—ãŸã€ã¨ã„ã†ãƒã‚¿ã‚’ã‚„ã‚ã†ã¨ã—ã¾ã—ãŸã€‚
ãã—ã¦ã€ãã®ä¸€ç’°ã¨ã—ã¦éå»ã®è‡ªåˆ†ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‹ã‚‰ãƒãƒ«ã‚³ãƒ•é€£é–ã‚’ä½¿ç”¨ã—ã¦ãƒ„ã‚¤ãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ã¿ã¾ã—ãŸã€‚

ã›ã£ã‹ããªã®ã§ãã®ã‚„ã‚Šæ–¹ã‚’ç°¡å˜ã«ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

## åŸºæœ¬æ–¹é‡

[ãƒãƒ«ã‚³ãƒ•é€£é–ã‚’ä½¿ã£ã¦è‡ªåˆ†ã‚‰ã—ã„æ–‡ç« ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹](https://qiita.com/hitsumabushi845/items/647f8bbe8d399f76825c)

åŸºæœ¬çš„ã«ã“ã¡ã‚‰ã®è¨˜äº‹ã«å¾“ã£ã¦ä½œæ¥­ã—ã¦ã„ãã¾ã™ã€‚

ãŸã ã—ã€ç¾åœ¨ã¯Twitterã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹è‡ªåˆ†ã®å…¨ãƒ„ã‚¤ãƒ¼ãƒˆã¯`tweets.csv`ã§ã¯ãªã`tweets.js`ã«å…¥ã£ã¦ã„ã‚‹ãŸã‚ã€ä¸»ã«ãã®ä»•æ§˜å¤‰æ›´ã«å¾“ã£ã¦å‰å‡¦ç†ã‚’å¤‰æ›´ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## å‰å‡¦ç†

### å…¨ãƒ„ã‚¤ãƒ¼ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

`Twitter Web > è¨­å®šã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ > ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ > ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰`ã‹ã‚‰ã€ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã™ã€‚

è©³ã—ãã¯

[æŠ•ç¨¿ã—ãŸå…¨ã¦ã®ãƒ„ã‚¤ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹](https://www.howtonote.jp/twitter/helpful/index1.html)

ã“ã¡ã‚‰ã®è¨˜äº‹ãªã©ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

æ•°æ—¥å¾Œãã‚‰ã„ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãŒä½œæˆã•ã‚ŒãŸã‚‰é€šçŸ¥ãŒå±Šãã¾ã™ã€‚
ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰ã€zipãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã—ã€ä¸­ã®`data/tweets.js`ã‚’ä»»æ„ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼orç§»å‹•ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

### `tweets.js`ã‹ã‚‰ãƒ„ã‚¤ãƒ¼ãƒˆã®æŠ½å‡º

å‰è¿°ã®ã¨ãŠã‚Šã€å…¨ãƒ„ã‚¤ãƒ¼ãƒˆã¯`tweets.js`ã«JSONå½¢å¼ã§å…¥ã£ã¦ã„ã¾ã™ã®ã§ã€ãã“ã‹ã‚‰å…¨ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ½å‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä¸‹è¨˜ã®Pythonã‚³ãƒ¼ãƒ‰ã‚’`tweets.js`ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚

```python:extractTweetsJsToText.py
import json
import re
from datetime import datetime 

read_since = '2020-04-01T00:00:00+00:00'

def escape_special_chars(s: str):
    return (s.replace('\n', '\\n'))

def is_newer_than(twitter_date_str: str, comparison_date: datetime):
    date_format = '%a %b %d %H:%M:%S %z %Y'
    parsed_date = datetime.strptime(twitter_date_str, date_format)
    return parsed_date > comparison_date

def load_tweets_json(tweets_js_file: str = 'tweets.js'):
    with open(tweets_js_file, 'r', encoding='utf-8') as file:
        content = file.read()
        cleaned_content = content.replace('window.YTD.tweets.part0 = ', '', 1)
    return json.loads(cleaned_content)

def write_tweets_txt(tweets_json, output_file: str = 'tweets.txt'):
    retweet_pattern = re.compile(r'RT .*\n')
    reply_pattern = re.compile(r'@[\w]+\s')
    url_pattern = re.compile(r'https?:\/\/[\w/:%#\$&\?\(\)~\.=\+\-]+')
    since_date = datetime.fromisoformat(read_since)

    with open(output_file, 'w', encoding='utf-8') as output:
        for tw in tweets_json:
            tweet = tw["tweet"]
            if not is_newer_than(tweet["created_at"], since_date):
                continue
            tweet_text = escape_special_chars(tweet["full_text"]) + '\n'
            tweet_text = retweet_pattern.sub('', tweet_text)
            tweet_text = reply_pattern.sub('', tweet_text)
            tweet_text = url_pattern.sub('', tweet_text)
            output.write(tweet_text)

if __name__ == '__main__':
    tweets_json = load_tweets_json()
    write_tweets_txt(tweets_json)
```

ã€Œã©ã®æ—¥æ™‚ä»¥é™ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ½å‡ºã™ã‚‹ã‹ã€ã‚’å¤‰æ›´ã—ãŸã„å ´åˆã€ä¸‹è¨˜ã®è¡Œã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```python
read_since = '2020-04-01T00:00:00+00:00'
```

ã“ã“ã§å…¨ãƒ„ã‚¤ãƒ¼ãƒˆã§ã¯ãªãã€æ—¥æ™‚ã‚’æŒ‡å®šã—ã¦æŠ½å‡ºã—ã¦ã„ã‚‹ç†ç”±ã¨ã—ã¦ã¯ã€

- æŠ½å‡ºã•ã‚ŒãŸãƒ„ã‚¤ãƒ¼ãƒˆãŒå¤šã™ãã‚‹ã¨ã€å˜ç´”ã«ã“ã®å¾Œã®å‡¦ç†ãŒæ™‚é–“ãŒã‹ã‹ã£ã¦é‡ããªã£ã¦ã—ã¾ã†
- ã‚ã¾ã‚Šæ˜”ã™ãã‚‹ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å«ã‚ã¦ã—ã¾ã†ã¨ã€ç”Ÿæ´»ç’°å¢ƒã®å¤‰åŒ–ãªã©ã«ã‚ˆã£ã¦ä½¿ç”¨ã™ã‚‹å˜èªãŒç•°ãªã£ã¦ãã¦ã„ã‚‹ãŸã‚ã€ç”Ÿæˆã™ã‚‹æ–‡ç« ã«ã€Œä»Šã®è‡ªåˆ†ã£ã½ã•ã€ãŒå‡ºãªããªã£ã¦ã—ã¾ã†[^old_tweets]

ã¨ã„ã£ãŸç†ç”±ã§ã™ã€‚

[^old_tweets]: å…·ä½“çš„ã«ã¯ã€ãŸã¨ãˆã°è‡ªåˆ†ã®å­¦ç”Ÿæ™‚ä»£ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‹ã‚‰å˜èªã‚’æ‹¾ã£ã¦ãã¦ã—ã¾ã„ã€ã€Œè¬›ç¾©ã€ã¨ã‹ã€Œå­¦é£Ÿã€ã¨ã‹ã¿ãŸã„ãªå­¦ç”Ÿã£ã½ã„å˜èªãŒå«ã¾ã‚ŒãŸãƒ„ã‚¤ãƒ¼ãƒˆãŒå¤šæ•°ç”Ÿæˆã•ã‚Œã¦ã—ã¾ã†ãªã©ã€‚

```sh
python extractTweetsJsToText.py
```

ã‚’å®Ÿè¡Œã—ã¦ã€åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`tweets.txt`ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
`tweets.txt`ã«ã¯1è¡Œ1ãƒ„ã‚¤ãƒ¼ãƒˆã®å½¢å¼ã§ãƒ„ã‚¤ãƒ¼ãƒˆãŒæŠ½å‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ

### MeCabã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

MeCabã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã„æ–¹ã¯ã€äº‹å‰ã«[ã“ã¡ã‚‰](https://taku910.github.io/mecab/)ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

ã¾ãŸã€è¾æ›¸ã¯UTF-8ã®ã‚‚ã®ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

åŒæ§˜ã«ã€Pythonã§MeCabãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã€

```sh
pip install mecab
```

ãªã©ã§Pythonç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

### sqliteã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

åŒæ§˜ã«ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã„æ–¹ã¯

```sh
pip install sqlite3
```

ãªã©ã§sqliteã®Pythonç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

### æ–‡ç« ç”Ÿæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

å®Ÿéš›ã«æ–‡ç« ã‚’ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã—ã¦ã€

[ohshige15/TextGenerator: ãƒãƒ«ã‚³ãƒ•é€£é–ã‚’ä½¿ã£ãŸæ–‡ç« è‡ªå‹•ç”Ÿæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ](https://github.com/ohshige15/TextGenerator)

ã“ã¡ã‚‰ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```sh
git clone git@github.com:ohshige15/TextGenerator.git
```

ãªã©ã§ä¸Šè¨˜ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—[^python3]ã€ä¸­ã®

- GenerateText.py
- PrepareChain.py
- schema.sql

ã‚’ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚

[^python3]: å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸQiitaè¨˜äº‹ã§ã¯ã€Python3ã¸ã®å¯¾å¿œãŒå¿…è¦ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€è‡ªåˆ†ãŒè©¦ã—ãŸæ™‚ç‚¹ã§ã¯æ—¢ã«Python3ã¸ã®å¯¾å¿œãŒæ¸ˆã‚“ã§ãŠã‚Šã€ç‰¹ã«å¯¾å¿œä¸è¦ã§ã—ãŸã€‚

[åŸºæœ¬æ–¹é‡](#åŸºæœ¬æ–¹é‡)ã§æŒ™ã’ãŸ[å‚è€ƒè¨˜äº‹](https://qiita.com/hitsumabushi845/items/647f8bbe8d399f76825c)ã«ã‚ã‚‹`storeTweetstoDB.py`ã‚’ä½¿ç”¨ã•ã›ã¦ã„ãŸã ãã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

ãŸã ã—ã€ä»Šå›ã¯æŠ½å‡ºã—ãŸãƒ„ã‚¤ãƒ¼ãƒˆãŒCSVã§ã¯ãªããƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ™ã‚¿æ›¸ãã•ã‚Œã¦ã„ã¾ã™ã®ã§ã€ãã‚Œã«å¯¾å¿œã—ãŸä¿®æ­£ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
ä¸‹è¨˜ã¯ä¿®æ­£å¾Œã®`storeTweetstoDB.py`ã§ã™ã€‚

```python:storeTweetstoDB.py
from PrepareChain import *
from tqdm import tqdm

def storeTweetstoDB():
    
    with open('tweets.txt', 'r', encoding='utf-8') as f:
        tweets = [line.strip() for line in f]

    print(len(tweets))

    chain = PrepareChain(tweets[0])
    triplet_freqs = chain.make_triplet_freqs()
    chain.save(triplet_freqs, True)

    for i in tqdm(tweets[1:]):
        chain = PrepareChain(i)
        triplet_freqs = chain.make_triplet_freqs()
        chain.save(triplet_freqs, False)

if __name__ == '__main__':
    storeTweetstoDB()
```

ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã—ã€

```sh
python storeTweetstoDB.py
```

ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã—ã°ã‚‰ãå¾…ã¤ã¨ã€`chain.db`ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

## æ–‡ç« ã®ç”Ÿæˆ

ã“ã‚Œã§æº–å‚™ã¯ã§ãã¾ã—ãŸã€‚
è©¦ã—ã«100å€‹ã»ã©æ–‡ç« ã‚’ç”Ÿæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python:generateMarkovTweets.py
from GenerateText import GenerateText

with open('generated_tweets.txt', 'w', encoding='utf-8') as f:
    for _ in range(100):
        generator = GenerateText()
        tweet = generator.generate()
        f.write(f'{tweet}\n')
```

ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã—ã€

```sh
python generateMarkovTweets.py
```

ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã—ã°ã‚‰ãå¾…ã¤ã¨ã€`generated_tweets.txt`ã«ãƒãƒ«ã‚³ãƒ•é€£é–ã§ç”Ÿæˆã•ã‚ŒãŸæ–‡ç« ãŒ100è¡Œã¶ã‚“ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™[^bot]ã€‚

[^bot]: æ˜¨ä»Šã®Twitterç¤¾ã«ã‚ˆã‚‹APIã¸ã®ç· ã‚ä»˜ã‘å¼·åŒ–ã®å½±éŸ¿ã‚‚ã‚ã‚Šã€ç­†è€…ã¯æ³£ãæ³£ããƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç”Ÿæˆã—ã¦ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹Botã‚’ä½œæˆã™ã‚‹ã§ã¯ãªãã€ã‚ã‚‰ã‹ã˜ã‚ç”Ÿæˆã—ãŸæ–‡ç« ã‚’å…¬å¼Webã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®äºˆç´„æŠ•ç¨¿ã§ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹æ–¹å¼ã‚’ã¨ã‚Šã¾ã—ãŸã€‚

## ãŠã‚ã‚Šã«

`tweets.js`ã‹ã‚‰ã®ãƒ„ã‚¤ãƒ¼ãƒˆã®æŠ½å‡ºã¯ã€ä»–ã®ç”¨é€”ã€ãŸã¨ãˆã°ã€ŒNotionãªã©ã®ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªã«ãƒ„ã‚¤ãƒ¼ãƒˆã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãŠãã€å¾Œã§æ¤œç´¢ã—ã‚„ã™ã„ã‚ˆã†ã«ã—ã¦ãŠãã€ãªã©å¿œç”¨ãŒåŠ¹ãã‹ã‚‚çŸ¥ã‚Œãªã„ãªã€ã¨æ€ã„ã¾ã—ãŸã€‚

ã¾ãŸã€ãƒãƒ«ã‚³ãƒ•é€£é–ã«ã‚ˆã‚‹æ–‡ç« ç”Ÿæˆã‚‚ã€ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢æ¬¡ç¬¬ã§æ§˜ã€…ãªãƒã‚¿ã«ä½¿ãˆãã†ã§ã™ã€‚

å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

## å‚è€ƒæ–‡çŒ®

- [ãƒãƒ«ã‚³ãƒ•é€£é–ã‚’ä½¿ã£ã¦è‡ªåˆ†ã‚‰ã—ã„æ–‡ç« ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹](https://qiita.com/hitsumabushi845/items/647f8bbe8d399f76825c)
- [æŠ•ç¨¿ã—ãŸå…¨ã¦ã®ãƒ„ã‚¤ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹](https://www.howtonote.jp/twitter/helpful/index1.html)
- [ohshige15/TextGenerator: ãƒãƒ«ã‚³ãƒ•é€£é–ã‚’ä½¿ã£ãŸæ–‡ç« è‡ªå‹•ç”Ÿæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ](https://github.com/ohshige15/TextGenerator)
